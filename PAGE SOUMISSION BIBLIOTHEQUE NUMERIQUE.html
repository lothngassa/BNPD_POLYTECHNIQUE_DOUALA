<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BNPD - T√©l√©versement de M√©moire</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f1f5f9; /* bg-slate-100 */
        }
        /* Style pour la zone de d√©p√¥t */
        #drop-area {
            border: 3px dashed #cbd5e1; /* border-slate-300 */
            transition: border-color 0.3s, background-color 0.3s;
        }
        #drop-area.highlight {
            border-color: #4f46e5; /* indigo-600 */
            background-color: #eef2ff; /* indigo-50 */
        }
        /* Ajoute un ast√©risque rouge pour les champs obligatoires */
        .required-label::after {
            content: '*';
            color: #ef4444; /* red-500 */
            margin-left: 0.25rem;
        }
        /* Style pour la liste de s√©lection d√©filante */
        select[size] option {
             padding: 8px 12px;
        }
    </style>
</head>
<body class="min-h-screen">

    <header class="bg-white shadow-md sticky top-0 z-10">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center">
            
            <div class="flex items-center gap-3">
                <img src="logo.png" onerror="this.onerror=null;this.src='https://placehold.co/40x40/4f46e5/ffffff?text=L'" alt="Logo BNPD" class="h-10 w-auto rounded-lg"> 
                <h1 class="text-lg sm:text-xl font-bold text-indigo-700 truncate">
                    Soumettre votre M√©moire
                </h1>
            </div>

            <div class="flex items-center space-x-4">
                <a href="index.html" class="bg-gray-100 text-gray-700 px-3 sm:px-4 py-2 rounded-lg font-semibold hover:bg-gray-200 transition duration-300 flex items-center text-sm sm:text-base border border-gray-200">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-4 h-4 mr-0 sm:mr-2">
                        <path d="M19 12H5"/><polyline points="12 19 5 12 12 5"/>
                    </svg>
                    <span class="hidden sm:inline-block">Accueil</span>
                </a>
                <button class="p-2 rounded-full bg-gray-100 hover:bg-indigo-100 text-gray-600 transition duration-300">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6">
                        <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/>
                    </svg>
                </button>
            </div>
        </div>
    </header>

    <main class="max-w-4xl mx-auto p-4 sm:p-6 lg:p-8">
        <div class="bg-white p-6 sm:p-8 rounded-xl shadow-2xl">
            <h2 class="text-3xl font-extrabold text-gray-800 mb-6 border-b pb-3">D√©tails de la Soumission</h2>
            
            <form id="upload-form" class="space-y-6">
                
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2 required-label">Fichier PDF du M√©moire</label>
                    <div id="drop-area" class="flex flex-col items-center justify-center p-10 rounded-xl cursor-pointer hover:bg-gray-50 transition-all duration-200">
                        <input type="file" id="file-input" name="fichier_pdf" accept=".pdf" class="hidden" required>
                        <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-10 h-10 text-indigo-500 mb-3">
                            <path d="M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242"/><path d="M12 12v9"/><path d="m8 17 4 4 4-4"/>
                        </svg>
                        <p class="text-gray-600 font-medium text-center">Glissez et d√©posez votre fichier PDF ici, ou</p>
                        <button type="button" onclick="document.getElementById('file-input').click()" class="mt-2 text-indigo-600 font-bold hover:text-indigo-800 transition duration-200">
                            Cliquez pour s√©lectionner un fichier
                        </button>
                        <p id="file-name-display" class="mt-3 text-sm text-gray-500 italic"></p>
                    </div>
                </div>

                <div>
                    <label for="titre" class="block text-sm font-semibold text-gray-700 mb-1 required-label">Titre du M√©moire</label>
                    <input type="text" id="titre" name="titre" placeholder="Ex: Conception d'un syst√®me de gestion de biblioth√®que d√©centralis√©" class="mt-1 block w-full border border-gray-300 rounded-lg shadow-sm p-3 focus:ring-indigo-500 focus:border-indigo-500" required>
                </div>

                <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                    <div>
                        <label for="auteur" class="block text-sm font-semibold text-gray-700 mb-1 required-label">Nom(s) de(s) l'Auteur(s)</label>
                        <input type="text" id="auteur" name="auteur" placeholder="Ex: LOTH NGASSA" class="mt-1 block w-full border border-gray-300 rounded-lg shadow-sm p-3 focus:ring-indigo-500 focus:border-indigo-500" required>
                    </div>
                    <div>
                        <label for="matricule" class="block text-sm font-semibold text-gray-700 mb-1 required-label">Matricule</label>
                        <input type="text" id="matricule" name="matricule" placeholder="Ex: 21G00238" class="mt-1 block w-full border border-gray-300 rounded-lg shadow-sm p-3 focus:ring-indigo-500 focus:border-indigo-500" required>
                    </div>
                </div>

                <div>
                    <label for="filiere" class="block text-sm font-semibold text-gray-700 mb-1 required-label">Fili√®re ENSPD</label>
                    <select id="filiere" name="filiere" class="mt-1 block w-full border border-gray-300 rounded-lg shadow-sm p-2 focus:ring-indigo-500 focus:border-indigo-500 bg-white" required size="5">
                        <option value="" disabled selected>Choisir une fili√®re...</option>
                        <option value="GIT">G√©nie Informatique et t√©l√©com (GIT)</option>
                        <option value="GCI">G√©nie Civil (GCI)</option>
                        <option value="GPH">G√©nie Physique (GPH)</option>
                        <option value="GM">G√©nie M√©canique (GM)</option>
                        <option value="GE">G√©nie √ânerg√©tique (GE)</option>
                        <option value="GP">G√©nie des Proc√©d√©s (GP)</option>
                        <option value="GMP">G√©nie Maritime et Portuaire (GMP)</option>
                        <option value="GAM">G√©nie Automobile et M√©catronique (GAM)</option>
                        <option value="QHSE">QHSE</option>
                        <option value="MP">Master Professionnel (MP)</option>
                    </select>
                </div>

                <div id="axe-container" class="hidden">
                    <label for="axe" class="block text-sm font-semibold text-gray-700 mb-1 required-label">Axe / Sp√©cialisation</label>
                    <select id="axe" name="axe" class="mt-1 block w-full border border-gray-300 rounded-lg shadow-sm p-3 focus:ring-indigo-500 focus:border-indigo-500 bg-white">
                        </select>
                </div>
                
                <div>
                    <label for="annee" class="block text-sm font-semibold text-gray-700 mb-1 required-label">Ann√©e de Soutenance</label>
                    <input type="number" id="annee" name="annee" min="2000" max="2099" step="1" placeholder="Ex: 2024" class="mt-1 block w-full border border-gray-300 rounded-lg shadow-sm p-3 focus:ring-indigo-500 focus:border-indigo-500" required>
                </div>


                <div>
                    <label for="keywords" class="block text-sm font-semibold text-gray-700 mb-1 required-label">Mots-cl√©s (S√©par√©s par une virgule)</label>
                    <input type="text" id="keywords" name="keywords" placeholder="Ex: Machine learning , Base de donn√©es, Syst√®me d√©centralis√©" class="mt-1 block w-full border border-gray-300 rounded-lg shadow-sm p-3 focus:ring-indigo-500 focus:border-indigo-500" required>
                </div>

                <div>
                    <label for="abstract" class="block text-sm font-semibold text-gray-700 mb-1 required-label">R√©sum√© / Abstract</label>
                    <textarea id="abstract" name="abstract" rows="6" placeholder="Fournissez un r√©sum√© concis (max 300 mots) de votre travail, objectifs et r√©sultats principaux." class="mt-1 block w-full border border-gray-300 rounded-lg shadow-sm p-3 focus:ring-indigo-500 focus:border-indigo-500 resize-none" required></textarea>
                </div>
                
                <div id="message-box" class="hidden p-4 rounded-lg" role="alert">
                    <p class="font-semibold" id="message-text">Message.</p>
                </div>

                <div>
                    <button type="submit" id="submit-button" class="w-full py-3 px-4 bg-indigo-600 text-white font-bold rounded-lg shadow-lg hover:bg-indigo-700 transition duration-300 transform hover:scale-[1.005] focus:outline-none focus:ring-4 focus:ring-indigo-500 focus:ring-opacity-50">
                        Soumettre le M√©moire
                    </button>
                </div>

            </form>
        </div>
    </main>

    <script>
// --- √âl√©ments du DOM (CORRIG√â) ---
const form = document.getElementById('upload-form'); // Utilisation de l'ID 'upload-form' si c'est celui de votre formulaire
    const submitButton = document.getElementById('submit-button'); // Utilisation de l'ID 'submit-button'
    const messageBox = document.getElementById('message-box');
    const messageText = document.getElementById('message-text');
    const fileInput = document.getElementById('file-input'); // Utilisation de l'ID 'file-input'
    const dropArea = document.getElementById('drop-area');
    const fileLabel = document.getElementById('file-name-display'); // Utilisation de l'ID 'file-name-display'
    const filiereSelect = document.getElementById('filiere');
    const axeContainer = document.getElementById('axe-container'); // << CORRIG√â : utilise 'axe-container'
    const axeSelect = document.getElementById('axe'); // << CORRIG√â : utilise 'axe'

    // Configuration de l'API
    // üí° CORRECTION 2: Utilisation de l'adresse de production
    const API_ENDPOINT = 'https://bn-polytechnique-douala-api.onrender.com/api/memoires/';

    // --- Mappage Fili√®res/Axes (CORRIG√â pour correspondre √† vos donn√©es initiales) ---
    const axesData = {
        'GIT': ['GLO (G√©nie Logiciel)', 'GRT (G√©nie R√©seaux et T√©l√©coms)', 'IA (Intelligence Artificielle)'],
        'GCI': ['B√¢timent', 'Travaux Publics', 'G√©otechnique', 'Hydraulique'],
        'GPH': ['Physique des Mat√©riaux', 'Physique Nucl√©aire', '√âlectronique'],
        'GM': ['Conception M√©canique', '√ânerg√©tique', 'Production'],
        'GE': ['√ânergies Renouvelables', 'Efficacit√© √ânerg√©tique', 'R√©seaux √âlectriques'],
        'GP': ['G√©nie Chimique', 'G√©nie Alimentaire', 'Environnement'],
        'GMP': ['Logistique Portuaire', 'Ing√©nierie Maritime', 'Gestion des Op√©rations'],
        'GAM': ['M√©catronique', 'Moteurs et Propulsion', 'Syst√®mes Embarqu√©s'],
        'QHSE': ['Qualit√©', 'Hygi√®ne', 'S√©curit√©', 'Environnement'],
        'MP': ['Biologie Appliqu√©e', 'Informatique de Gestion', 'Management de Projet', 'Autre']
    };

    // --- Fonction d'initialisation des axes (ADAPT√âE) ---
    function updateAxeOptions(filiere) {
        axeSelect.innerHTML = '<option value="">Choisir un axe...</option>';
        axeSelect.required = false;

        if (filiere && axesData[filiere] && axesData[filiere].length > 0) {
            axesData[filiere].forEach(axe => {
                const option = document.createElement('option');
                option.value = axe;
                option.textContent = axe;
                axeSelect.appendChild(option);
            });
            axeContainer.classList.remove('hidden');
            axeSelect.required = true;
        } else {
            axeContainer.classList.add('hidden');
        }
    }

    // --- Fonction utilitaire pour afficher les messages ---
    function showMessage(text, type) {
        messageBox.classList.remove('hidden', 'bg-red-100', 'text-red-700', 'border-red-300', 'bg-green-100', 'text-green-700', 'border-green-300', 'bg-yellow-100', 'text-yellow-700', 'border-yellow-300');
        
        messageText.textContent = text;

        if (type === 'error') {
            messageBox.classList.add('bg-red-100', 'text-red-700', 'border-red-300');
        } else if (type === 'success') {
            messageBox.classList.add('bg-green-100', 'text-green-700', 'border-green-300');
        } else if (type === 'info') {
            messageBox.classList.add('bg-yellow-100', 'text-yellow-700', 'border-yellow-300');
        } else {
            messageBox.classList.add('hidden');
        }
    }

    // --- Fonction de soumission √† l'API ---
    async function handleSubmission(event) {
        event.preventDefault();
        
        if (fileInput.files.length === 0) {
            showMessage("Veuillez s√©lectionner le fichier PDF de votre m√©moire.", 'error');
            return;
        }

        submitButton.disabled = true;
        submitButton.textContent = 'Envoi en cours...';
        showMessage("Envoi du m√©moire en cours. Veuillez patienter...", 'info');

        const formData = new FormData(form);

        try {
            const response = await fetch(API_ENDPOINT, {
                method: 'POST',
                body: formData,
            });

            if (response.ok) {
                const result = await response.json();
                showMessage(`Soumission r√©ussie ! Titre: "${result.titre}". Le m√©moire est maintenant disponible.`, 'success');
                form.reset();
            } else {
                const errorData = await response.json();
                console.error("Erreur de soumission:", errorData);

                let errorMessage = `Une erreur est survenue lors de l'envoi (Code: ${response.status}).`;

                if (response.status === 400 && errorData) {
                    errorMessage += " V√©rifiez les champs:";
                    for (const key in errorData) {
                        errorMessage += ` [${key} : ${errorData[key][0]}]`;
                    }
                } else if (response.status >= 500) {
                    errorMessage = "Erreur interne du serveur. Le serveur Django est-il correctement configur√© ?";
                }
                showMessage(errorMessage, 'error');
            }
        } catch (error) {
            console.error("Erreur r√©seau:", error);
            showMessage("Erreur de connexion au serveur. Assurez-vous que l'adresse de l'API est correcte et accessible.", 'error');
        } finally {
            submitButton.disabled = false;
            submitButton.textContent = 'Soumettre le M√©moire';
        }
    }

    // -----------------------------------------------------------------
    // --- √âv√©nements ---
    // -----------------------------------------------------------------

    // √âcouteur pour le champ Fili√®re
    filiereSelect.addEventListener('change', (e) => updateAxeOptions(e.target.value));

    // Soumission du formulaire
    form.addEventListener('submit', handleSubmission);

    // Logique Drag and Drop
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
        dropArea.addEventListener(eventName, preventDefaults, false);
    });
    ['dragenter', 'dragover'].forEach(eventName => {
        dropArea.addEventListener(eventName, () => dropArea.classList.add('highlight'), false);
    });
    ['dragleave', 'drop'].forEach(eventName => {
        dropArea.addEventListener(eventName, () => dropArea.classList.remove('highlight'), false);
    });
    dropArea.addEventListener('drop', handleDrop, false);

    // Gestion de la s√©lection de fichier
    fileInput.addEventListener('change', () => {
        if (fileInput.files.length > 0) {
            fileLabel.textContent = fileInput.files[0].name;
            showMessage('', 'none'); 
        } else {
            fileLabel.textContent = 'Glisser-d√©poser le fichier PDF ou cliquer pour s√©lectionner';
        }
    });

    // Fonction de gestion du drop
    function handleDrop(e) {
        const dt = e.dataTransfer;
        const files = dt.files;
        
        if (files.length === 1 && files[0].type === 'application/pdf') {
            fileInput.files = files; 
            fileLabel.textContent = files[0].name;
            showMessage('', 'none');
        } else {
            showMessage("Veuillez d√©poser un seul fichier au format PDF (.pdf).", 'error');
        }
    }

    function preventDefaults(e) {
        e.preventDefault();
        e.stopPropagation();
    }

    // R√©initialisation du formulaire 
    form.addEventListener('reset', () => {
        setTimeout(() => {
            updateAxeOptions(""); 
            fileLabel.textContent = 'Glisser-d√©poser le fichier PDF ou cliquer pour s√©lectionner';
            showMessage('', 'none');
        }, 0);
    });

    // Initialisation au chargement de la page
    updateAxeOptions(filiereSelect.value);
    </script>

</body>
</html>